<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Playground - lexy</title><style>:root{--white:white;--header-white:rgba(255, 255, 255, .75);--background-color:#fdfdfd;--default-color:#101010;--heading-color:#0A0A0A;--link-color:#2A2A2A;--gray-highlight-color:#aaaaaa;--highlight-color:#2861ce}@media(prefers-color-scheme:dark){:root{--white:#020202;--header-white:rgba(2, 2, 2, .75);--background-color:#222222;--default-color:#efefef;--heading-color:#f5f5f5;--link-color:#d5d5d5;--gray-highlight-color:#555555}}nav#menu div.menu-container,main{max-width:1200px;margin:0 auto;padding:0 10px}@media(min-width:800px){article{max-width:900px;margin:0 auto;padding:0 10px}}html{position:relative;min-height:100%;margin:0;padding:0}body{font-family:serif;font-size:18px;color:var(--default-color);background-color:var(--background-color);width:100%;padding:0;margin:0}main{margin-bottom:75px}h1,h2,h3,h4,h5,h6{font-family:sans-serif;font-weight:700;line-height:1.15em;color:var(--heading-color);margin:0 0 .4em;hyphens:auto}h1{font-size:2em}h2{font-size:1.75em}h3{font-size:1.5em}h4{font-size:1.25em}h5{font-size:1.15em}h6{font-size:1.1em}a{color:var(--link-color);transition:color ease .3s}a:hover{color:var(--highlight-color)}a:focus{outline:none}br{margin:1em}article p,article ul,article ol,article dl,article td{hyphens:auto;text-align:justify}nav#menu{width:100%;padding:0;background-color:var(--white);border-bottom:2px solid var(--highlight-color);font-family:sans-serif;font-size:1.3em}nav#menu div.menu-container{display:flex}nav#menu div.menu-container ul{display:flex;flex-direction:row;align-items:center;padding:0;list-style:none}nav#menu div.menu-container ul li a{text-decoration:none}nav#menu div.menu-container ul li a.active{border-width:0 0 2px;border-style:solid;border-color:var(--highlight-color)}nav#menu div.menu-container ul#home{padding-left:0;padding-right:10px}nav#menu div.menu-container ul#home li{font-weight:700}nav#menu div.menu-container ul#main{margin-left:auto}nav#menu div.menu-container ul#main li{padding-left:20px}@media(max-width:600px){nav#menu div.menu-container ul#main{flex-direction:column;align-items:flex-end;margin:5px 10px 0 auto}}footer#page-footer{position:absolute;bottom:0;left:0;right:0;height:2em;display:flex;justify-content:space-between;font-size:.8em;font-weight:200;line-height:1em;border-top:1px solid #ccc}footer#page-footer section{padding-left:1em;padding-right:1em;padding-top:.5em;width:100%}footer#page-footer .copyright{text-align:left}footer#page-footer .patreon{text-align:center}footer#page-footer .poweredby{text-align:right}@media(max-width:450px){footer#page-footer{flex-direction:column;align-items:flex-start}footer#page-footer section{text-align:initial!important;width:initial}}aside.toc{display:none}@media(min-width:1200px){aside.toc{display:initial;position:sticky;top:1em;float:left;width:300px}aside.toc header{font-weight:700}aside.toc ul{list-style:none;padding:0}aside.toc ul ul{padding-left:1em;padding-bottom:.5em}aside.toc a{text-decoration:none}aside.toc~article{padding-left:300px}}article .admonitionblock{margin-bottom:1em}article .admonitionblock td.icon{width:75px;font-weight:700;border-right:1px solid var(--gray-highlight-color);padding:.5em}article .admonitionblock td.content{padding-left:.5em}article details{padding-bottom:1em}article details summary{font-weight:700}article dl dt{font-weight:700}article dl dd{margin-top:-.9em}article dl dd dt{margin-top:.9em}article div.sidebarblock{border:1px solid var(--gray-highlight-color);padding:.75em;margin:1em}article div.sidebarblock p{margin:0}article :not(td)>div.title{font-style:italic;margin-bottom:-.9em}article code{font-family:Inconsolata,monospace,sans-serif}article pre{overflow:auto;padding:10px;background:var(--white);border:1px solid var(--gray-highlight-color);line-height:1.1}article .colist{margin-top:-.5em}article .colist ol{counter-reset:list}article .colist ol li{counter-increment:list;padding-left:1em}article .colist ol ::marker{content:"(" counter(list)")";font-weight:700}article .colist p{margin:0}article .highlight{}article .highlight .c{color:#998;font-style:italic}article .highlight .k{color:#458;font-weight:700}article .highlight .o{color:red}article .highlight .p{color:red}article .highlight .err{color:red}article .highlight .cm{color:#998;font-style:italic}article .highlight .cp{color:green;font-weight:700}article .highlight .c1{color:#998;font-style:italic}article .highlight .cs{color:#999;font-weight:700;font-style:italic}article .highlight .gd{color:#000;background-color:#fdd}article .highlight .gd .x{color:#000;background-color:#faa}article .highlight .ge{font-style:italic}article .highlight .gr{color:#a00}article .highlight .gh{color:#999}article .highlight .gi{color:#000;background-color:#dfd}article .highlight .gi .x{color:#000;background-color:#afa}article .highlight .go{color:#888}article .highlight .gp{color:#555}article .highlight .gs{font-weight:700}article .highlight .gu{color:#aaa}article .highlight .gt{color:#a00}article .highlight .kc{color:#458;font-weight:700}article .highlight .kd{color:#458;font-weight:700}article .highlight .kp{color:#458;font-weight:700}article .highlight .kr{color:#458;font-weight:700}article .highlight .kt{color:#458;font-weight:700}article .highlight .m{color:#ff8000}article .highlight .s{color:green}article .highlight .ow{font-weight:700}article .highlight .w{color:#bbb}article .highlight .mf{color:#ff8000}article .highlight .mh{color:#ff8000}article .highlight .mi{color:#ff8000}article .highlight .mo{color:#ff8000}article .highlight .sb{color:#d14}article .highlight .sc{color:#d14}article .highlight .sd{color:#d14}article .highlight .s2{color:#d14}article .highlight .se{color:#d14}article .highlight .sh{color:#d14}article .highlight .si{color:#d14}article .highlight .sx{color:#d14}article .highlight .sr{color:#009926}article .highlight .s1{color:#d14}article .highlight .ss{color:#990073}article .highlight .bp{color:#999}article .highlight .vc{color:teal}article .highlight .vg{color:teal}article .highlight .vi{color:teal}article .highlight .il{color:#099}</style></head><body><nav id=menu><div class=menu-container><ul id=home><li><a href=/>lexy: C++ parser combinator library</a></li></ul><ul id=main><li><a href=/tutorial/>Tutorial</a></li><li><a href=/reference/>Reference</a></li><li><a class=active href=/playground/>Playground</a></li><li><a href=https://github.com/foonathan/lexy>GitHub</a></li></ul></nav><section id=playground><section id=toolbar><div class=toolbar-editor-options><button id=toolbar-permalink title="Create a permalink to this example.">Permalink</button>
<input type=checkbox id=toolbar-vim>
<label for=toolbar-vim title="Enable/disable vim bindings.">Vim</label>
<input type=checkbox id=toolbar-wrap checked>
<label for=toolbar-wrap title="Enable/disable word wrap.">Wrap</label></div><div class=toolbar-run-options><label for=toolbar-production>Entry production:</label>
<select id=toolbar-production></select>
<button id=toolbar-run type=button>Run</button>
<button id=toolbar-godbolt type=button>
<img src=https://godbolt.org/favicon.ico alt="CE logo" title="View on Compiler Explorer."></button></div></section><section id=editors><div class=editor-container><div class=editor id=editor-grammar></div></div><div class=editor-container><div class=editor id=editor-input></div></div></section><section id=output><div class=output-container id=output-graph></div><textarea class=output-container id=output-text cols=80 rows=10 autocomplete=off readonly>
</textarea></section><section><p>Enter the grammar in the left editor (<code>lexy/dsl.hpp</code> and namespace alias <code>dsl</code> is pre-included) and the input in the right editor.
The result of parsing the selected entry production on that input is displayed in the bottom window.
The encoding is <code>lexy::utf8_encoding</code>.</p><p>The online playground is powered by <a href=https://godbolt.org/>Compiler Explorer</a>, <a href=https://ace.c9.io/>Ace</a>, and <a href=https://github.com/magjac/d3-graphviz>d3-graphviz</a>.</p></section><style>:root{--white:white;--header-white:rgba(255, 255, 255, .75);--background-color:#fdfdfd;--default-color:#101010;--heading-color:#0A0A0A;--link-color:#2A2A2A;--gray-highlight-color:#aaaaaa;--highlight-color:#2861ce}@media(prefers-color-scheme:dark){:root{--white:#020202;--header-white:rgba(2, 2, 2, .75);--background-color:#222222;--default-color:#efefef;--heading-color:#f5f5f5;--link-color:#d5d5d5;--gray-highlight-color:#555555}}#playground{padding:1em}#toolbar{display:flex;justify-content:space-between;align-items:baseline;margin-bottom:1em}#toolbar input[type=checkbox]{vertical-align:middle}#toolbar #toolbar-godbolt{padding:0}#toolbar #toolbar-godbolt img{height:1em}#editors{display:flex;flex-wrap:wrap;margin-bottom:5px}#editors .editor-container{flex-grow:1;min-width:30em;height:30em;border:1px solid var(--gray-highlight-color);margin:5px}#editors .editor{position:relative;width:100%;height:100%}#output{display:flex;margin:5px}#output .output-container{flex-grow:1;border:1px solid var(--gray-highlight-color)}#output #output-text{resize:none}#output #output-graph{display:none}#output #output-graph svg{width:100%}</style><script src=https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.12/ace.js></script><script src=https://d3js.org/d3.v5.min.js></script><script src=https://unpkg.com/@hpcc-js/wasm@0.3.11/dist/index.min.js></script><script src=https://unpkg.com/d3-graphviz@3.0.5/build/d3-graphviz.js></script><script type=module>
import * as playground from "https:\/\/lexy.foonathan.net\/playground.js";

const toolbar_permalink  = document.getElementById("toolbar-permalink");
const toolbar_vim        = document.getElementById("toolbar-vim");
const toolbar_wrap       = document.getElementById("toolbar-wrap");
const toolbar_production = document.getElementById("toolbar-production");
const toolbar_run        = document.getElementById("toolbar-run");
const toolbar_godbolt    = document.getElementById("toolbar-godbolt");

const editor_grammar = ace.edit("editor-grammar");
const editor_input = ace.edit("editor-input");

const output_text  = document.getElementById("output-text");
const output_graph = document.getElementById("output-graph");

function update_toolbar_production()
{
    const source      = editor_grammar.getValue();
    const productions = playground.list_of_productions(source);

    
    const current_selection = toolbar_production.value;
    toolbar_production.innerHTML = '';
    for (var prod of productions)
    {
        var option = document.createElement("option");
        option.value = prod;
        option.innerHTML = `<code>${prod}</code>`;
        option.selected = (prod == current_selection);

        toolbar_production.appendChild(option);
    }
}

async function load()
{
    const storage = window.sessionStorage;
    const default_grammar = `struct name
{
    static constexpr auto rule = dsl::while_(dsl::ascii::alnum / dsl::lit_c<'_'> / dsl::lit_c<'-'>);
};

struct production
{
    static constexpr auto rule = []{
        auto greeting = LEXY_LIT("Hello");
        return greeting + dsl::ascii::space + dsl::p<name> + dsl::lit_c<'!'> + dsl::eof;
    }();
};
`;
    const default_input = "Hello World!";
    const default_production = "production";

    const params = new URLSearchParams(window.location.search);
    const id = params.get("id");
    if (id !== null)
    {
        const godbolt = await playground.load_godbolt_url(id);
        storage.setItem('editor-grammar',  godbolt.grammar);
        storage.setItem('editor-input',  godbolt.input);
        storage.setItem('toolbar-production',  godbolt.production);

        console.log(godbolt);
    }

    // Load session entry or default.
    editor_grammar.setValue(storage.getItem('editor-grammar') || default_grammar, 1);
    editor_input.setValue(storage.getItem('editor-input') || default_input, 1);

    
    update_toolbar_production();
    toolbar_production.value = storage.getItem('toolbar-production') || default_production;
}

function save()
{
    const storage = window.sessionStorage;

    
    window.history.replaceState({}, document.title, "https://lexy.foonathan.net/playground/");

    
    storage.setItem('editor-grammar', editor_grammar.getValue());
    storage.setItem('editor-input', editor_input.getValue());
    storage.setItem('toolbar-production', toolbar_production.value);
}

function toggle_vim()
{
    for (var editor of [editor_grammar, editor_input])
    {
        if (toolbar_vim.checked)
            editor.setKeyboardHandler("ace/keyboard/vim");
        else
            editor.setKeyboardHandler("");
    }
}
function toggle_wrap()
{
    for (var editor of [editor_grammar, editor_input])
        editor.getSession().setUseWrapMode(toolbar_wrap.checked);
}

async function run()
{
    toolbar_run.disabled = true;

    const source = playground.preprocess_source('playground', editor_grammar.getValue(), toolbar_production.value);
    const input  = editor_input.getValue();

    const result = await playground.compile_and_run(source, input);
    if (result.success)
    {
        if (result.code == 0)
        {
            d3.select(output_graph).graphviz().renderDot(result.stdout);
            output_text.style.display = "none";
            output_graph.style.display = "block";
        }
        else
        {
            output_text.value = result.stderr;
            output_text.style.display = "block";
            output_graph.style.display = "none";
        }
    }
    else
    {
        output_text.value = result.message;
        output_text.style.display = "block";
        output_graph.style.display = "none";
    }

    toolbar_run.disabled = false;
}

function debounce(func, delay)
{
    var timeout;
    return function() {
        clearTimeout(timeout);
        timeout = setTimeout(func, delay);
    };
}

window.addEventListener('load', async() => {
    editor_grammar.setTheme("ace/theme/github");
    editor_grammar.session.setMode("ace/mode/c_cpp");
    editor_grammar.setShowPrintMargin(false);

    editor_input.setTheme("ace/theme/github");
    editor_input.session.setMode("ace/mode/text");
    editor_input.setShowPrintMargin(false);

    await load();
    editor_grammar.getSession().on('change', debounce(save, 1000));
    editor_input.getSession().on('change', debounce(save, 1000));

    editor_grammar.getSession().on('change', debounce(update_toolbar_production, 1000));

    editor_grammar.getSession().on('change', debounce(run, 1000));
    editor_input.getSession().on('change', debounce(run, 1000));

    toolbar_permalink.addEventListener("click", async() => {
        const source = playground.preprocess_source('godbolt', editor_grammar.getValue(), toolbar_production.value);
        const input  = editor_input.getValue();

        const url = await playground.get_godbolt_url(source, input);
        const id = url.substring(url.lastIndexOf('/') + 1);
        window.history.replaceState({}, document.title, "https:\/\/lexy.foonathan.net\/playground\/?id=" + id);
    });
    toolbar_vim.addEventListener("click", toggle_vim);
    toolbar_wrap.addEventListener("click", toggle_wrap);
    toolbar_run.addEventListener("click", run);
    toolbar_godbolt.addEventListener("click", async() => {
        const source = playground.preprocess_source('godbolt', editor_grammar.getValue(), toolbar_production.value);
        const input  = editor_input.getValue();
        window.location.href = await playground.get_godbolt_url(source, input);
    });

    toggle_vim();
    toggle_wrap();
    run();
});
</script><footer id=page-footer><section class=copyright>&copy; 2020-2021</section><section class=patreon><a target=_blank href=https://jonathanmueller.dev/support-me/>Support me!</a>.</section><section class=poweredby>Made with <a target=_blank href=https://gohugo.io>Hugo</a>.</section></footer></body></html>